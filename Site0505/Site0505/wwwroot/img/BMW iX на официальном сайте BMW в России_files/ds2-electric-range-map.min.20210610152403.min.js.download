define("ds2-electric-range-map",[],function(){function d(a,b,c,d,e){this.element=a;this.util=e;this.elements={chargingStations:a.querySelector('button[data-action\x3d"display-charging-stations"]'),controlContainer:a.querySelector(".ds2-electric-range__map-controls"),feedbackContainer:a.querySelector(".ds2-electric-range__map-feedback"),locateMe:a.querySelector('button[data-action\x3d"locate-me"]'),map:a.querySelector(".ds2-electric-range__map"),output:a.querySelector(".ds2-electric-range__map-messages output"),
searchBox:a.querySelector('input[data-action\x3d"search"]'),zoomIn:a.querySelector('button[data-action\x3d"zoom-in"]'),zoomOut:a.querySelector('button[data-action\x3d"zoom-out"]')};this.options={api:{provider:b},mapsApiUrl:a.dataset.mapsApiUrl,locationServices:a.hasAttribute("data-location-services"),reverseGeocoding:a.hasAttribute("data-reverse-geocoding"),color:{white:"255, 255, 255",blue:"28, 105, 212"},ringsNumber:7,markerLevels:3,timeout:{},width:this.element.clientWidth};this.options.range=
{data:c,max:d,center:{lat:Number(a.dataset.latitude),lng:Number(a.dataset.longitude)},meterConversionFactor:"miles"!==a.dataset.rangeUnit?1E3:1609.34,strokeColor:{circle:"rgba("+this.options.color.blue+", 1)",marker:"rgba("+this.options.color.white+", 0)"},strokeWidth:{outerCircle:1,innerCircle:2,marker:1},fillColor:{circle:"rgba("+this.options.color.white+", 0)",marker:"rgba("+this.options.color.blue+", 1)"},opacity:{bounds:0,electric:.3,marker:1},offset:{x:0,y:767>=this.options.width?0:-40}};this.options.mapsApiUrl&&
(this.addMapsApiScript(),this.initializeMapsApi(),this.addEventListeners())}d.prototype.addMapsApiScript=function(){if(!document.getElementById("maps-api-script")){var a=document.createElement("script");a.setAttribute("id","maps-api-script");a.setAttribute("src",this.options.mapsApiUrl);document.body.appendChild(a)}};d.prototype.initializeMapsApi=function(){var a=this;"google"===a.options.api.provider?require(["ds2-electric-range-map-google"],function(b){a.api=new b(a.element,a.options.range,a.util)}):
"yandex"===a.options.api.provider&&require(["ds2-electric-range-map-yandex"],function(b){a.api=new b(a.element,a.options.range,a.util)})};d.prototype.addEventListeners=function(){var a=this;a.element.addEventListener("api-init-success",function(){a.options.api.initialized=!0;a.elements.controlContainer.classList.add("is-visible");a.addCustomZoomButtons();a.updateRangeOnMap();a.elements.locateMe&&a.options.locationServices&&a.getUserLocation()});a.element.addEventListener("api-init-failed",function(){a.sendMessage({code:"service"})});
a.element.addEventListener("new-map-position",function(){a.updateRangeOnMap()});a.elements.searchBox.addEventListener("click",function(){a.sendMessage()});a.elements.chargingStations.addEventListener("click",function(){a.util.trackEvent({element:this,eventInfo:{type:"ux"}})});window.addEventListener("resize",function(){a.resizeHandler()})};d.prototype.addCustomZoomButtons=function(){var a=this;a.elements.zoomIn.addEventListener("click",function(){a.api.zoomIn()});a.elements.zoomOut.addEventListener("click",
function(){a.api.zoomOut()})};d.prototype.updateRangeOnMap=function(a){var b=this,c=b.options.range.data,d=.1,e=1,f=b.options.range.opacity.marker,g=10;a&&(c=a);clearTimeout(b.options.timeout.api);if(void 0===b.api)b.options.timeout.api=setTimeout(function(){b.updateRangeOnMap()},100);else if(b.options.api.initialized){if(!b.options.rangeElementsCreated){b.elements.circles=[];for(a=0;a<b.options.ringsNumber;a++)b.elements.circles[a]=b.api.createCircle(d,a===b.options.ringsNumber-1?b.options.range.strokeWidth.innerCircle:
b.options.range.strokeWidth.outerCircle),d+=.1;b.elements.centerCircles=[];for(a=0;a<b.options.markerLevels;a++)b.elements.centerCircles[a]=b.api.createMarker(g,f),f=.3,g+=6;b.elements.boundsCircle=b.api.createCircle(b.options.range.opacity.bounds);b.elements.label=b.api.createLabel();b.options.rangeElementsCreated=!0}b.api.applyBatch(function(){b.api.updateCircle(b.elements.boundsCircle,b.options.range.max.electric);b.api.setCenter(b.elements.boundsCircle)}).then(function(){for(var a=0;a<b.options.ringsNumber;a++)b.api.updateCircle(b.elements.circles[a],
c.maxRange*e,b.options.range.opacity.electric),e-=.05;for(a=0;a<b.options.markerLevels;a++)b.api.updateMarker(b.elements.centerCircles[a]);a=1;"miles"===c.rangeUnit&&(a=.621371);a=5*Math.round(parseFloat(c.maxRange*a).toFixed(0)/5)+" "+c.rangeUnit;var d=c.html.getAttribute("estimatedrange");b.api.updateLabel(b.elements.label,a,d,b.elements.circles[0])});b.elements.locateMe&&(b.elements.locateMe.dataset.status="1");b.sendMessage()}b.options.range.data=c};d.prototype.getUserLocation=function(){var a=
this,b=a.elements.locateMe;navigator.geolocation?(b.dataset.status="1",b.addEventListener("click",function(){b.dataset.status="0";a.sendMessage();a.util.trackEvent({element:b});navigator.geolocation.getCurrentPosition(function(c){b.dataset.status="2";a.options.range.center={lat:c.coords.latitude,lng:c.coords.longitude};a.api.getAddressFromGeoCode(a.options.range.center,a.options.reverseGeocoding);a.updateRangeOnMap()},function(c){b.dataset.status="3";a.sendMessage(c)},{enableHighAccuracy:!1,maximumAge:6E4})})):
b.parentNode.removeChild(b)};d.prototype.sendMessage=function(a){var b=this.elements.output.dataset,c="";if(a){switch(a.code){case "service":c=b.serviceError;break;case a.PERMISSION_DENIED:c=b.geoDenied;break;case a.POSITION_UNAVAILABLE:c=b.geoUnavailable;break;case a.TIMEOUT:c=b.geoTimeout;break;case a.UNKNOWN_ERROR:c=b.geoUnavailable}c&&""!==c&&(this.elements.feedbackContainer.classList.add("is-visible"),this.elements.output["value"in this.elements.output?"value":"textContent"]=c,b.errorCode=a.code?
a.code:a,this.util.trackEvent({element:this.elements.output,eventInfo:{type:"error",effect:'tr \x3e error message "'+c+'" appeared'},attributes:{errorCode:b.errorCode},additionalData:!1}))}else this.elements.feedbackContainer.classList.remove("is-visible")};d.prototype.resizeHandler=function(){this.options.width=this.element.clientWidth;this.options.range.offset.y=767>=this.options.width?0:-40;this.api.setCenter()};return d});